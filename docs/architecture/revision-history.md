# Revision History

### 2025-11-10 (Second Update): Tech Stack Validation & Refinements

**Changes made based on user feedback and architecture validation:**

1. **Authentication Strategy:** Switched from custom JWT implementation to Clerk managed authentication service
   - Reduces development time by 2-3 stories
   - Provides OAuth, 2FA, magic links out-of-the-box
   - Free tier: 10K MAU, then $25/1000 MAU
2. **AI Model Selection:** Standardized on GPT-4o-mini for primary interactions, GPT-4o for narrative generation only
   - Target operational cost: ~$0.03/user/day (well under $0.50 target)
   - Balance between quality and cost efficiency
3. **Emotion Detection:** Selected `cardiffnlp/twitter-roberta-base-emotion-multilingual-latest` open source model
   - 7 emotions (joy, anger, sadness, fear, love, surprise, neutral)
   - Self-hosted (no per-request costs), ~50ms inference time
   - Privacy-friendly (data stays on infrastructure)
4. **Story Sequencing:** Moved Story 1.4 (User Onboarding Flow) to later in development

   - Rationale: Can't design effective onboarding without app features existing first
   - Will be completed after Epic 2 (Companion & Memory System)

5. **Documentation Improvements:** Added three new ADRs (ADR-007, ADR-008, ADR-009) documenting authentication, emotion detection, and LLM selection decisions

**Impact:**

- Faster MVP development (Clerk eliminates auth complexity)
- Better cost predictability (~$0.03/user/day for AI vs $0.50 target)
- Open source emotion detection reduces vendor lock-in
- More logical story sequence (core features → onboarding)

---

### 2025-11-10: Architecture Validation Updates

**Changes made based on validation feedback:**

1. **Cost Model Updated:** Changed from $0.10/user/day to $0.50/user/day operational target, with $1/day subscription pricing + pay-as-you-go model
2. **Vector Storage Migration:** Switched from Chroma (embedded) to PostgreSQL pgvector for unified storage and production-readiness
3. **Observability Solidified:** Confirmed Sentry for error tracking, performance monitoring, and session replay
4. **Background Job Reliability:** Added retry strategies, dead letter queue, and monitoring dashboard specifications
5. **Real-Time Architecture Enhanced:** Added WebSocket for world state updates (alongside SSE for AI streaming) to eliminate polling delays
6. **Data Type Standardization:** Standardized on JSON type (not JSONB) for flexible schema columns with documented trade-offs

**Impact:**

- Eliminates future migration from Chroma → production vector DB
- Clearer cost expectations and monitoring requirements
- Better real-time user experience for world state changes
- Production-ready from day one

---

_Generated by BMAD Decision Architecture Workflow v1.3.2_  
_Date: 2025-11-09_  
_Updated: 2025-11-10 (twice)_  
_For: Jack_
